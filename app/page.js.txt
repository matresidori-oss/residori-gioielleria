'use client'
import { useState, useRef } from 'react'

export default function Home() {
  const [sel, setSel] = useState({ tipo: '', metallo: '', pietra: '', occasione: '' })
  const [freeText, setFreeText] = useState('')
  const [status, setStatus] = useState('idle')
  const [jewel, setJewel] = useState(null)
  const [imageUrl, setImageUrl] = useState('')
  const [errorDetail, setErrorDetail] = useState('')
  const [customerName, setCustomerName] = useState('')
  const [customerPhone, setCustomerPhone] = useState('')
  const [showSaveModal, setShowSaveModal] = useState(false)
  const [savedMsg, setSavedMsg] = useState('')
  const [mobileMenu, setMobileMenu] = useState(false)
  const designerRef = useRef(null)
  const storyRef = useRef(null)

  const choose = (group, val) => setSel(s => ({ ...s, [group]: s[group] === val ? '' : val }))

  const scrollTo = (ref) => {
    setMobileMenu(false)
    ref?.current?.scrollIntoView({ behavior: 'smooth' })
  }

  // ‚îÄ‚îÄ‚îÄ GENERATE ‚îÄ‚îÄ‚îÄ
  const generate = async () => {
    const parts = []
    if (sel.tipo) parts.push(`Tipologia: ${sel.tipo}`)
    if (sel.metallo) parts.push(`Metallo: ${sel.metallo}`)
    if (sel.pietra) parts.push(`Pietra: ${sel.pietra}`)
    if (sel.occasione) parts.push(`Occasione: ${sel.occasione}`)
    if (freeText) parts.push(`Visione: "${freeText}"`)
    const desc = parts.length ? parts.join(', ') : 'gioiello di lusso italiano straordinario'

    setStatus('loading-claude')
    setJewel(null)
    setImageUrl('')
    setErrorDetail('')

    try {
      // Step 1: Claude genera scheda + narrativa
      const r1 = await fetch('/api/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ description: desc })
      })
      const d1 = await r1.json()
      if (!d1.success) throw new Error(d1.error || 'Errore generazione scheda')
      setJewel(d1.jewel)

      // Step 2: DALL-E genera l'immagine
      if (d1.jewel.image_prompt) {
        setStatus('loading-dalle')
        const r2 = await fetch('/api/image', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: d1.jewel.image_prompt })
        })
        const d2 = await r2.json()
        if (d2.success && d2.imageUrl) setImageUrl(d2.imageUrl)
      }

      setStatus('done')
    } catch (e) {
      setErrorDetail(e.message || 'Errore sconosciuto')
      setStatus('error')
    }
  }

  // ‚îÄ‚îÄ‚îÄ WHATSAPP ‚îÄ‚îÄ‚îÄ
  const sendWhatsApp = () => {
    if (!jewel) return
    const msg = encodeURIComponent(
      `‚ú¶ Gioielleria Residori ‚Äî Nuovo progetto ‚ú¶\n\n` +
      `Gioiello: ${jewel.nome}\nTipo: ${jewel.tipo_breve}\n` +
      (jewel.scheda ? Object.entries(jewel.scheda).map(([k, v]) => `${k}: ${v}`).join('\n') : '') +
      `\n\nNarrativa: ${jewel.narrativa}\n\n` +
      (customerName ? `Cliente: ${customerName}\n` : '') +
      (customerPhone ? `Tel: ${customerPhone}\n` : '') +
      `\nVorrei realizzare questo gioiello. Posso venire in negozio?`
    )
    window.open(`https://wa.me/393616296637?text=${msg}`, '_blank')
  }

  const opts = {
    tipo: [['üíç','Anello'],['üìø','Collana'],['‚ú®','Orecchini'],['‚≠ï','Bracciale'],['üå∏','Spilla'],['üëë','Parure']],
    metallo: [['üü°','Oro Giallo 18kt'],['‚ö™','Oro Bianco 18kt'],['üå∏','Oro Rosa 18kt'],['üíé','Platino 950']],
    pietra: [['üíé','Diamante'],['‚ù§Ô∏è','Rubino'],['üíö','Smeraldo'],['üíô','Zaffiro'],['ü§ç','Perla'],['‚Äî','Solo metallo']],
    occasione: [['üíç','Proposta'],['üíë','Anniversario'],['üéÅ','Regalo'],['‚òÄÔ∏è','Quotidiano'],['‚ú®','Cerimonia']]
  }

  const G = '#B8953E', GL = '#D4B05C', D = '#1A1714', D2 = '#231F18', D3 = '#2C261E', W = '#6B5D48', WL = '#9E8D74', I = '#FAF7F2'

  return (
    <>
      <style>{`
        *{margin:0;padding:0;box-sizing:border-box}
        html{scroll-behavior:smooth}
        body{background:${I};color:${D};font-family:'Jost',sans-serif;font-weight:300;min-height:100vh}
        ::selection{background:#B8953E33}
        input:focus,textarea:focus{outline:none}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

        @media(max-width:768px){
          .hero-title{font-size:34px!important}
          .hero-sub{font-size:17px!important}
          .nav-links{display:none!important}
          .burger{display:flex!important}
          .hero-section{padding:40px 20px!important;min-height:70vh!important}
          .section-pad{padding:48px 20px!important}
          .designer-grid{grid-template-columns:1fr!important}
          .stat-row{flex-direction:column!important;gap:16px!important}
          .footer-inner{flex-direction:column!important;text-align:center!important;gap:12px!important}
          .btn-row{flex-direction:column!important}
          .btn-row button{width:100%!important}
        }
      `}</style>

      {/* ‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê */}
      <nav style={{background:D,padding:'0 clamp(20px,4vw,48px)',display:'flex',alignItems:'center',justifyContent:'space-between',height:68,borderBottom:`1px solid ${G}22`,position:'sticky',top:0,zIndex:1000}}>
        <div style={{display:'flex',alignItems:'baseline',gap:8}}>
          <span style={{fontFamily:"'Playfair Display',serif",fontSize:21,fontWeight:600,color:GL,letterSpacing:2}}>RESIDORI</span>
          <span style={{fontSize:9,letterSpacing:3,color:WL,textTransform:'uppercase'}}>Gioielleria</span>
        </div>
        <div className="nav-links" style={{display:'flex',gap:28,alignItems:'center'}}>
          {[['La Nostra Storia',storyRef],['Crea il Tuo',designerRef]].map(([l,r])=>(
            <span key={l} onClick={()=>scrollTo(r)} style={{fontSize:11,letterSpacing:2,textTransform:'uppercase',color:WL,cursor:'pointer',transition:'color .3s'}}
              onMouseEnter={e=>e.target.style.color=GL} onMouseLeave={e=>e.target.style.color=WL}>{l}</span>
          ))}
          <span onClick={()=>window.open('https://wa.me/393616296637','_blank')} style={{fontSize:11,letterSpacing:2,textTransform:'uppercase',color:D,background:G,padding:'8px 16px',cursor:'pointer'}}>Contattaci</span>
        </div>
        <div className="burger" onClick={()=>setMobileMenu(!mobileMenu)} style={{display:'none',flexDirection:'column',gap:5,cursor:'pointer',padding:8}}>
          <div style={{width:24,height:1.5,background:GL,transition:'all .3s',transform:mobileMenu?'rotate(45deg) translate(4px,4px)':'none'}}/>
          <div style={{width:24,height:1.5,background:GL,transition:'all .3s',opacity:mobileMenu?0:1}}/>
          <div style={{width:24,height:1.5,background:GL,transition:'all .3s',transform:mobileMenu?'rotate(-45deg) translate(4px,-4px)':'none'}}/>
        </div>
      </nav>

      {/* Mobile menu */}
      {mobileMenu&&(
        <div style={{position:'fixed',top:68,left:0,right:0,bottom:0,background:D+'F5',zIndex:999,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:32,animation:'fadeIn .3s'}}>
          {[['La Nostra Storia',storyRef],['Crea il Tuo Gioiello',designerRef]].map(([l,r])=>(
            <span key={l} onClick={()=>scrollTo(r)} style={{fontFamily:"'Playfair Display',serif",fontSize:24,color:GL,cursor:'pointer'}}>{l}</span>
          ))}
          <button onClick={()=>{setMobileMenu(false);window.open('https://wa.me/393616296637','_blank')}} style={{padding:'14px 28px',background:G,color:'#fff',border:'none',fontSize:12,letterSpacing:2,textTransform:'uppercase',cursor:'pointer',fontFamily:'inherit'}}>WhatsApp</button>
        </div>
      )}

      {/* ‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê */}
      <section className="hero-section" style={{minHeight:'88vh',display:'flex',flexDirection:'column',justifyContent:'center',padding:'80px clamp(28px,6vw,80px) 60px',position:'relative',overflow:'hidden',background:`linear-gradient(160deg,${I} 0%,#F5EFE3 40%,#EDE4D2 100%)`}}>
        <div style={{position:'absolute',right:'-10%',top:'20%',width:'40vw',height:'40vw',borderRadius:'50%',border:`1px solid ${G}15`,pointerEvents:'none'}}/>
        <div style={{fontSize:10,letterSpacing:6,textTransform:'uppercase',color:G,marginBottom:28,display:'flex',alignItems:'center',gap:16}}>
          <span style={{width:40,height:1,background:G,display:'inline-block'}}/>Dal 1960 ¬∑ Guidizzolo (MN)
        </div>
        <h1 className="hero-title" style={{fontFamily:"'Playfair Display',serif",fontSize:'clamp(38px,5.5vw,72px)',fontWeight:400,lineHeight:1.08,marginBottom:24,maxWidth:650}}>
          L'arte orafa<br/><em style={{fontStyle:'italic',color:G}}>incontra</em> il futuro
        </h1>
        <p className="hero-sub" style={{fontFamily:"'Cormorant Garamond',serif",fontSize:21,fontStyle:'italic',color:W,lineHeight:1.7,marginBottom:44,maxWidth:520}}>
          Descrivi il gioiello che sogni e la nostra intelligenza artificiale lo progetter√† per te con un rendering fotografico realistico. Poi vieni a trovarci in bottega: lo realizzeremo a mano, pezzo unico.
        </p>
        <div className="btn-row" style={{display:'flex',gap:16,flexWrap:'wrap'}}>
          <button onClick={()=>scrollTo(designerRef)} style={{padding:'16px 32px',fontSize:12,letterSpacing:3,textTransform:'uppercase',fontWeight:500,border:'none',background:`linear-gradient(135deg,${G},${GL})`,color:'#fff',cursor:'pointer',fontFamily:'inherit'}}>‚ú¶ Progetta il tuo gioiello</button>
        </div>
        <div className="stat-row" style={{display:'flex',gap:48,marginTop:56,paddingTop:32,borderTop:`1px solid ${G}20`}}>
          {[['60+','Anni di tradizione'],['100%','Made in Italy'],['‚àû','Pezzi unici']].map(([n,l])=>(
            <div key={l}>
              <div style={{fontFamily:"'Playfair Display',serif",fontSize:28,color:G,fontWeight:500}}>{n}</div>
              <div style={{fontSize:11,letterSpacing:2,textTransform:'uppercase',color:W,marginTop:4}}>{l}</div>
            </div>
          ))}
        </div>
      </section>

      {/* ‚ïê‚ïê‚ïê STORIA ‚ïê‚ïê‚ïê */}
      <section ref={storyRef} className="section-pad" style={{padding:'80px clamp(28px,6vw,80px)',background:D,color:I}}>
        <div style={{maxWidth:900,margin:'0 auto'}}>
          <div style={{fontSize:10,letterSpacing:5,textTransform:'uppercase',color:G,marginBottom:20,display:'flex',alignItems:'center',gap:12}}>
            <span style={{width:32,height:1,background:G,display:'inline-block'}}/>Chi Siamo
          </div>
          <h2 style={{fontFamily:"'Playfair Display',serif",fontSize:'clamp(28px,3.5vw,44px)',fontWeight:400,lineHeight:1.15,marginBottom:32}}>
            Gioielleria <em style={{fontStyle:'italic',color:GL}}>Residori</em>
          </h2>
          <div style={{fontFamily:"'Cormorant Garamond',serif",fontSize:19,fontStyle:'italic',lineHeight:1.8,color:'#C8B89A',maxWidth:700}}>
            <p style={{marginBottom:20}}>
              Da generazioni, la famiglia Residori custodisce l'arte orafa nel cuore di Guidizzolo.
              Ogni gioiello che esce dal nostro laboratorio porta con s√© ore di lavoro a mano,
              la scelta meticolosa delle pietre e dei metalli, e quel tocco inconfondibile che solo
              la tradizione italiana sa dare.
            </p>
            <p style={{marginBottom:20}}>
              Oggi uniamo questa eredit√† con l'innovazione: un'intelligenza artificiale ti aiuta a
              immaginare il gioiello perfetto, ma sono sempre le mani dei nostri maestri orafi a dargli vita.
              Nessuna stampa 3D, nessuna produzione in serie. Solo artigianato puro.
            </p>
            <p>
              Vieni a trovarci in <strong style={{color:GL,fontStyle:'normal'}}>Via Solferino 69, Guidizzolo (MN)</strong> ‚Äî
              saremo felici di mostrarti il laboratorio e di progettare insieme il tuo gioiello.
            </p>
          </div>
          <div style={{marginTop:40}}>
            <button onClick={()=>window.open('https://wa.me/393616296637?text='+encodeURIComponent('Buongiorno, vorrei visitare il vostro laboratorio a Guidizzolo.'),'_blank')}
              style={{padding:'16px 32px',fontSize:12,letterSpacing:3,textTransform:'uppercase',fontWeight:500,border:'none',background:`linear-gradient(135deg,${G},${GL})`,color:'#fff',cursor:'pointer',fontFamily:'inherit'}}>
              Prenota una visita
            </button>
          </div>
        </div>
      </section>

      {/* ‚ïê‚ïê‚ïê AI DESIGNER ‚ïê‚ïê‚ïê */}
      <section ref={designerRef} className="section-pad" style={{padding:'80px clamp(28px,6vw,80px)',background:D,color:I,borderTop:`1px solid ${G}15`}}>
        <div style={{maxWidth:1100,margin:'0 auto'}}>
          <div style={{fontSize:10,letterSpacing:5,textTransform:'uppercase',color:G,marginBottom:16,display:'flex',alignItems:'center',gap:12}}>
            <span style={{width:32,height:1,background:G,display:'inline-block'}}/>Progettazione AI
          </div>
          <h2 style={{fontFamily:"'Playfair Display',serif",fontSize:'clamp(28px,3.5vw,40px)',fontWeight:400,lineHeight:1.15,marginBottom:12}}>
            Crea il tuo gioiello <em style={{fontStyle:'italic',color:GL}}>unico</em>
          </h2>
          <p style={{fontFamily:"'Cormorant Garamond',serif",fontSize:17,fontStyle:'italic',color:WL,marginBottom:40,maxWidth:600}}>
            Seleziona le caratteristiche, racconta la tua visione, e l'intelligenza artificiale progetter√† il gioiello dei tuoi sogni con un rendering fotografico realistico.
          </p>

          <div className="designer-grid" style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:32}}>
            {/* LEFT */}
            <div style={{display:'flex',flexDirection:'column',gap:20}}>
              {Object.entries(opts).map(([key,items],qi)=>(
                <div key={key}>
                  <div style={{fontSize:10,letterSpacing:3,textTransform:'uppercase',color:G,marginBottom:10}}>
                    {['01 ‚Äî Tipologia','02 ‚Äî Metallo','03 ‚Äî Pietra','04 ‚Äî Occasione'][qi]}
                  </div>
                  <div style={{display:'flex',gap:8,flexWrap:'wrap'}}>
                    {items.map(([emoji,label])=>{
                      const active=sel[key]===label
                      return(
                        <button key={label} onClick={()=>choose(key,label)} style={{
                          padding:'10px 16px',display:'flex',alignItems:'center',gap:8,
                          background:active?`${G}25`:D3,border:`1px solid ${active?G:G+'20'}`,
                          color:active?GL:WL,cursor:'pointer',fontSize:12,fontFamily:'inherit',transition:'all .25s'
                        }}><span>{emoji}</span>{label}</button>
                      )
                    })}
                  </div>
                </div>
              ))}

              <div>
                <div style={{fontSize:10,letterSpacing:3,textTransform:'uppercase',color:G,marginBottom:10}}>05 ‚Äî La tua visione</div>
                <textarea value={freeText} onChange={e=>setFreeText(e.target.value)}
                  placeholder="Descrivi liberamente... un'emozione, un ricordo, una persona speciale. Pi√π dettagli dai, pi√π il progetto sar√† unico."
                  style={{width:'100%',minHeight:100,padding:16,background:D3,border:`1px solid ${G}20`,color:I,
                    fontFamily:"'Cormorant Garamond',serif",fontSize:16,fontStyle:'italic',lineHeight:1.7,resize:'vertical'}}/>
              </div>

              <button onClick={generate} disabled={status==='loading-claude'||status==='loading-dalle'}
                style={{width:'100%',padding:18,fontSize:12,letterSpacing:3,textTransform:'uppercase',fontWeight:500,
                  border:'none',background:`linear-gradient(135deg,${G},${GL})`,color:'#fff',cursor:'pointer',fontFamily:'inherit',
                  opacity:status.startsWith('loading')?.5:1,transition:'all .3s'}}>
                {status==='loading-claude'?'Claude sta progettando...':status==='loading-dalle'?'DALL-E sta creando l\'immagine...':'‚ú¶ Genera il tuo gioiello ‚ú¶'}
              </button>
            </div>

            {/* RIGHT */}
            <div style={{background:D2,border:`1px solid ${G}15`,overflow:'hidden',minHeight:500,display:'flex',flexDirection:'column'}}>
              <div style={{padding:'16px 20px',borderBottom:`1px solid ${G}10`,display:'flex',alignItems:'center',justifyContent:'space-between'}}>
                <span style={{fontSize:10,letterSpacing:3,textTransform:'uppercase',color:WL}}>Il tuo progetto</span>
                <span style={{fontSize:9,letterSpacing:2,textTransform:'uppercase',padding:'4px 12px',background:`${G}15`,color:G}}>
                  {status==='idle'?'In attesa':status==='loading-claude'?'Claude al lavoro...':status==='loading-dalle'?'DALL-E rendering...':status==='done'?'‚ú¶ Pronto':'Errore'}
                </span>
              </div>

              {/* IDLE */}
              {status==='idle'&&(
                <div style={{flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',textAlign:'center',padding:40}}>
                  <div style={{fontSize:56,opacity:.15,marginBottom:16}}>üíç</div>
                  <div style={{fontFamily:"'Cormorant Garamond',serif",fontSize:16,fontStyle:'italic',color:WL,opacity:.5,lineHeight:1.7}}>
                    Il progetto del tuo gioiello<br/>apparir√† qui.
                  </div>
                </div>
              )}

              {/* LOADING */}
              {(status==='loading-claude'||status==='loading-dalle')&&(
                <div style={{flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:20,padding:40}}>
                  <div style={{width:48,height:48,borderRadius:'50%',border:`1px solid ${G}20`,borderTopColor:G,animation:'spin 1s linear infinite'}}/>
                  <div style={{textAlign:'center'}}>
                    <div style={{fontSize:12,letterSpacing:2,textTransform:'uppercase',color:WL}}>
                      {status==='loading-claude'?'Progettazione in corso...':'Rendering fotografico HD...'}
                    </div>
                    <div style={{fontFamily:"'Cormorant Garamond',serif",fontSize:13,fontStyle:'italic',color:`${G}50`,marginTop:6}}>
                      {status==='loading-claude'?'Narrativa e scheda tecnica...':'DALL-E 3 sta generando l\'immagine...'}
                    </div>
                  </div>
                </div>
              )}

              {/* RESULT */}
              {status==='done'&&jewel&&(
                <div style={{display:'flex',flexDirection:'column',animation:'fadeIn .6s'}}>
                  {/* Image or emoji */}
                  <div style={{position:'relative',background:`linear-gradient(160deg,${D3},#0d0a06)`,aspectRatio:'1/1',display:'flex',alignItems:'center',justifyContent:'center',overflow:'hidden'}}>
                    <div style={{position:'absolute',inset:0,background:`radial-gradient(ellipse at center,${G}0a 0%,transparent 65%)`}}/>
                    {imageUrl
                      ? <img src={imageUrl} alt={jewel.nome} style={{width:'100%',height:'100%',objectFit:'cover',display:'block',position:'relative',zIndex:1}}/>
                      : <div style={{fontSize:72,position:'relative',zIndex:1}}>{jewel.emoji||'üíç'}</div>
                    }
                    {/* Watermark */}
                    <div style={{position:'absolute',bottom:0,left:0,right:0,padding:'24px 20px 16px',background:'linear-gradient(transparent,rgba(13,10,6,0.92))',zIndex:2}}>
                      <div style={{fontFamily:"'Playfair Display',serif",fontSize:22,fontStyle:'italic',color:GL,lineHeight:1.2}}>{jewel.nome}</div>
                      <div style={{fontSize:10,letterSpacing:3,textTransform:'uppercase',color:WL,marginTop:4}}>{jewel.tipo_breve}</div>
                    </div>
                  </div>

                  <div style={{padding:20,display:'flex',flexDirection:'column',gap:16}}>
                    {/* Narrativa */}
                    <div style={{background:D3,padding:18,borderLeft:`2px solid ${G}`}}>
                      <div style={{fontSize:9,letterSpacing:3,textTransform:'uppercase',color:G,marginBottom:8}}>‚ú¶ L'Anima del Gioiello</div>
                      <div style={{fontFamily:"'Cormorant Garamond',serif",fontSize:15,fontStyle:'italic',color:'#EFE8D8',lineHeight:1.8}}>{jewel.narrativa}</div>
                    </div>

                    {/* Scheda */}
                    <div style={{background:D3,padding:18}}>
                      <div style={{fontSize:9,letterSpacing:3,textTransform:'uppercase',color:G,marginBottom:12}}>Scheda Tecnica</div>
                      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10}}>
                        {jewel.scheda&&Object.entries(jewel.scheda).map(([k,v])=>(
                          <div key={k}>
                            <div style={{fontSize:9,letterSpacing:1,textTransform:'uppercase',color:WL,marginBottom:2}}>{k}</div>
                            <div style={{fontSize:12,color:I}}>{v}</div>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Watermark brand */}
                    <div style={{textAlign:'center',padding:12,fontSize:9,letterSpacing:3,textTransform:'uppercase',color:`${G}50`,borderTop:`1px solid ${G}10`,borderBottom:`1px solid ${G}10`}}>
                      ‚ú¶ Gioielleria Residori ¬∑ Via Solferino 69 ¬∑ Guidizzolo (MN) ‚ú¶
                    </div>

                    {/* CTA */}
                    <div style={{background:`linear-gradient(135deg,${G}12,${G}05)`,border:`1px solid ${G}25`,padding:20,textAlign:'center'}}>
                      <div style={{fontFamily:"'Cormorant Garamond',serif",fontSize:15,fontStyle:'italic',color:WL,marginBottom:16,lineHeight:1.6}}>
                        Questo gioiello pu√≤ diventare realt√†.<br/>I nostri maestri orafi lo realizzeranno a mano per te.
                      </div>
                      <div className="btn-row" style={{display:'flex',gap:12,justifyContent:'center',flexWrap:'wrap'}}>
                        <button onClick={()=>setShowSaveModal(true)} style={{padding:'12px 24px',fontSize:11,letterSpacing:2,textTransform:'uppercase',fontWeight:500,border:'none',background:`linear-gradient(135deg,${G},${GL})`,color:'#fff',cursor:'pointer',fontFamily:'inherit'}}>
                          Salva progetto
                        </button>
                        <button onClick={sendWhatsApp} style={{padding:'12px 24px',fontSize:11,letterSpacing:2,textTransform:'uppercase',fontWeight:500,border:'1px solid #25D366',background:'transparent',color:'#25D366',cursor:'pointer',fontFamily:'inherit'}}>
                          Invia WhatsApp
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* ERROR */}
              {status==='error'&&(
                <div style={{flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',gap:12,padding:40,textAlign:'center'}}>
                  <div style={{fontSize:36}}>‚ö†Ô∏è</div>
                  <div style={{fontSize:13,color:WL}}>Errore nella generazione.</div>
                  {errorDetail&&<div style={{fontSize:11,color:'#ff9966',maxWidth:300,wordBreak:'break-word',padding:12,background:'rgba(255,100,50,0.1)',borderRadius:8}}>{errorDetail}</div>}
                  <button onClick={generate} style={{padding:'10px 20px',fontSize:11,letterSpacing:2,textTransform:'uppercase',border:'none',background:G,color:'#fff',cursor:'pointer',fontFamily:'inherit',marginTop:8}}>Riprova</button>
                </div>
              )}
            </div>
          </div>

          {/* SAVE MODAL */}
          {showSaveModal&&(
            <div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.7)',zIndex:2000,display:'flex',alignItems:'center',justifyContent:'center',padding:24}} onClick={()=>setShowSaveModal(false)}>
              <div onClick={e=>e.stopPropagation()} style={{background:D2,border:`1px solid ${G}30`,padding:32,maxWidth:420,width:'100%',animation:'fadeIn .3s'}}>
                <div style={{fontSize:10,letterSpacing:3,textTransform:'uppercase',color:G,marginBottom:20}}>‚ú¶ Salva il tuo progetto</div>
                <p style={{fontSize:13,color:WL,marginBottom:20,lineHeight:1.6}}>
                  Inserisci i tuoi dati. Ritroverai il tuo progetto quando verrai a trovarci in negozio.
                </p>
                <input value={customerName} onChange={e=>setCustomerName(e.target.value)} placeholder="Nome e Cognome *"
                  style={{width:'100%',padding:14,marginBottom:12,background:D3,border:`1px solid ${G}20`,color:I,fontSize:14,fontFamily:'inherit'}}/>
                <input value={customerPhone} onChange={e=>setCustomerPhone(e.target.value)} placeholder="Telefono (facoltativo)"
                  style={{width:'100%',padding:14,marginBottom:20,background:D3,border:`1px solid ${G}20`,color:I,fontSize:14,fontFamily:'inherit'}}/>
                <div className="btn-row" style={{display:'flex',gap:12}}>
                  <button onClick={()=>{
                    if(!customerName.trim())return
                    const msg=encodeURIComponent(`‚ú¶ NUOVO PROGETTO SALVATO ‚ú¶\n\nCliente: ${customerName}\nTel: ${customerPhone||'non fornito'}\n\nGioiello: ${jewel.nome}\nTipo: ${jewel.tipo_breve}\n${jewel.scheda?Object.entries(jewel.scheda).map(([k,v])=>`${k}: ${v}`).join('\n'):''}\n\nNarrativa: ${jewel.narrativa}`)
                    window.open(`https://wa.me/393616296637?text=${msg}`,'_blank')
                    setShowSaveModal(false)
                    setSavedMsg(`‚ú¶ Progetto "${jewel.nome}" inviato!`)
                    setCustomerName('');setCustomerPhone('')
                    setTimeout(()=>setSavedMsg(''),4000)
                  }} style={{flex:1,padding:'14px',fontSize:11,letterSpacing:2,textTransform:'uppercase',border:'none',background:G,color:'#fff',cursor:'pointer',fontFamily:'inherit',fontWeight:500}}>
                    Salva e invia su WhatsApp
                  </button>
                  <button onClick={()=>setShowSaveModal(false)} style={{flex:1,padding:'14px',fontSize:11,letterSpacing:2,textTransform:'uppercase',border:`1px solid ${G}`,background:'transparent',color:G,cursor:'pointer',fontFamily:'inherit'}}>
                    Annulla
                  </button>
                </div>
              </div>
            </div>
          )}

          {savedMsg&&(
            <div style={{position:'fixed',bottom:24,left:'50%',transform:'translateX(-50%)',background:'#25D366',color:'#fff',padding:'14px 28px',fontSize:13,fontWeight:500,zIndex:3000,animation:'fadeIn .3s',boxShadow:'0 8px 32px rgba(0,0,0,.3)'}}>
              {savedMsg}
            </div>
          )}
        </div>
      </section>

      {/* ‚ïê‚ïê‚ïê CTA FINALE ‚ïê‚ïê‚ïê */}
      <section className="section-pad" style={{padding:'80px clamp(28px,6vw,80px)',background:I,textAlign:'center'}}>
        <div style={{fontSize:10,letterSpacing:6,textTransform:'uppercase',color:G,marginBottom:24}}>‚ú¶ Vieni a trovarci ‚ú¶</div>
        <h2 style={{fontFamily:"'Playfair Display',serif",fontSize:'clamp(24px,3vw,36px)',fontWeight:400,marginBottom:12}}>Il tuo gioiello ti aspetta in bottega</h2>
        <p style={{fontFamily:"'Cormorant Garamond',serif",fontSize:18,fontStyle:'italic',color:W,marginBottom:32,maxWidth:500,margin:'0 auto 32px'}}>
          Via Solferino 69, Guidizzolo (MN)
        </p>
        <button onClick={()=>window.open('https://wa.me/393616296637?text='+encodeURIComponent('Buongiorno, vorrei informazioni sui vostri gioielli.'),'_blank')}
          style={{padding:'16px 32px',fontSize:12,letterSpacing:3,textTransform:'uppercase',fontWeight:500,border:'none',background:`linear-gradient(135deg,${G},${GL})`,color:'#fff',cursor:'pointer',fontFamily:'inherit'}}>
          Scrivici su WhatsApp
        </button>
      </section>

      {/* ‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê */}
      <footer style={{background:D,padding:'32px clamp(20px,4vw,48px)',borderTop:`1px solid ${G}10`}}>
        <div className="footer-inner" style={{display:'flex',alignItems:'center',justifyContent:'space-between',maxWidth:1100,margin:'0 auto'}}>
          <div>
            <span style={{fontFamily:"'Playfair Display',serif",fontSize:16,letterSpacing:2,color:GL}}>RESIDORI</span>
            <span style={{fontSize:10,color:WL,marginLeft:8}}>Gioielleria</span>
          </div>
          <div style={{fontSize:11,color:`${W}80`,letterSpacing:1}}>¬© 2026 ¬∑ Via Solferino 69, Guidizzolo (MN) ¬∑ Made in Italy</div>
          <div style={{fontSize:11,color:WL,cursor:'pointer'}} onClick={()=>window.open('https://wa.me/393616296637','_blank')}>
            WhatsApp: 361 629 6637
          </div>
        </div>
      </footer>
    </>
  )
}
